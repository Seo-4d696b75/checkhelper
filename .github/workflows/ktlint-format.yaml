name: Ktlint Format

on:
  pull_request:
    branches:
      - 'develop'
    types:
      - closed

env:
  GRADLE_KTLINT_TASK: 'ktlintFormat'

permissions:
  contents: write
  pull-requests: write

jobs:
  format:
    name: Format with ktlint
    runs-on: ubuntu-20.04
    if: github.event.pull_request.merged == true
    steps:
      - name: Check out
        uses: actions/checkout@v4
        with:
          ref: ${{ github.base_ref }}
      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: "zulu"
          java-version: "17"
          cache: "gradle"
      - name: Format with ktlint
        run: ./gradlew $GRADLE_KTLINT_TASK
      - name: Create pull request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: 'Format with ktlint'
          author: 'GitHub <noreply@github.com>' # ワークフローファイルの作成者になってしまう問題を回避
          title: 'Format with ktlint (auto generated)'
          body: 'This PR was automatically generated by the [${{ github.workflow }}](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}).'
          branch: 'feature/ktlint-format'
          branch-suffix: 'short-commit-hash' # 同じプルリクは作らない
